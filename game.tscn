[gd_scene format=3 uid="uid://cltoc1fobd4yx"]

[ext_resource type="Script" uid="uid://b32i8mqgc8vrr" path="res://game.gd" id="1_80nbo"]
[ext_resource type="PackedScene" uid="uid://dji7tytceexa3" path="res://movement_test/character_run.tscn" id="2_feb5d"]
[ext_resource type="Script" uid="uid://fem0shj6kr8h" path="res://camera.gd" id="3_eow3j"]
[ext_resource type="PackedScene" uid="uid://c3xyum43h7j3r" path="res://pages/page1_test.tscn" id="3_fc0e3"]
[ext_resource type="PackedScene" uid="uid://qa47f04qccbp" path="res://pages/page2_test.tscn" id="4_7jktm"]
[ext_resource type="Script" uid="uid://hgctsa5inf0p" path="res://target_animation.gd" id="4_j5wjh"]
[ext_resource type="Script" uid="uid://8hn2y811b0n8" path="res://target_animation_config.gd" id="5_j5wjh"]
[ext_resource type="PackedScene" uid="uid://dkcbw3cmj3bv3" path="res://models/pushpin.tscn" id="6_ryrav"]
[ext_resource type="PackedScene" uid="uid://b3bmcwcs6wp1k" path="res://pages/page 3.tscn" id="8_iotsf"]
[ext_resource type="Script" uid="uid://btf4vy1tqv2el" path="res://models/pushpin_managers.gd" id="9_hve3p"]
[ext_resource type="AudioStream" uid="uid://coqy6et1rom4g" path="res://music/groovy picture book combined.mp3" id="10_hve3p"]
[ext_resource type="Texture2D" uid="uid://bbdjy2kx388np" path="res://UI/pushpin.png" id="11_mfdv2"]
[ext_resource type="PackedScene" uid="uid://cs6iqsbiq7ea1" path="res://models/edge.tscn" id="12_iotsf"]

[sub_resource type="Resource" id="Resource_vef74"]
script = ExtResource("5_j5wjh")
damping_constant = 50.0
metadata/_custom_type_script = "uid://8hn2y811b0n8"

[sub_resource type="Resource" id="Resource_j5wjh"]
script = ExtResource("5_j5wjh")
spring_constant = 250.0
damping_constant = 50.0
metadata/_custom_type_script = "uid://8hn2y811b0n8"

[sub_resource type="GDScript" id="GDScript_hve3p"]
script/source = "extends Node3D

@export var page_scenes: Array[PackedScene] = []

func _ready() -> void:
	for page_scene in page_scenes:
		var page_3d: Page3D = preload(\"res://page3d.tscn\").instantiate()
		page_3d.page_scene = page_scene
		add_child(page_3d)
		
		if !page_3d.is_node_ready(): await page_3d.ready
		var page := page_3d.page
		var outline_projector := preload(\"res://outline_projector.tscn\").instantiate()
		outline_projector.origin_node = %PageProjectorOrigin
		outline_projector.page = page
		add_child(outline_projector)
		
		get_parent().active_page_changed.connect(
			func(active_page: Page):
				var active_page_index: int = get_parent().active_page_index
				var page_index: int = get_parent().index_of_page(page)
				if page_index == active_page_index - 1:
					outline_projector.start_casting()
				else:
					outline_projector.stop_casting()
		)
"

[sub_resource type="GDScript" id="GDScript_mfdv2"]
script/source = "extends Node2D

func _draw() -> void:
	var projector = $\"../Pages/OutlineProjector\"
	var tex: Texture2D = projector.__outline_viewport.get_texture()
	draw_texture(tex, Vector2.ZERO)
"

[node name="Game" type="Node3D" unique_id=519886471]
script = ExtResource("1_80nbo")

[node name="PlayerSprite" type="Sprite3D" parent="." unique_id=843110985]
unique_name_in_owner = true
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0.675, -0.347, 0.01)

[node name="character_run" parent="PlayerSprite" unique_id=1773396158 instance=ExtResource("2_feb5d")]
transform = Transform3D(-5.2453664e-09, 0, 0.12, 0, 0.12, 0, -0.12, 0, -5.2453664e-09, 0, 0, 0)

[node name="Camera3D" type="Camera3D" parent="." unique_id=10132499]
transform = Transform3D(1, 0, 0, 0, 0.9837067, 0.1797809, 0, -0.1797809, 0.9837067, 0, 0.4850288, 2.091046)
current = true
fov = 22.3
size = 1.3631029
script = ExtResource("3_eow3j")

[node name="XTargetAnimation" type="Node" parent="Camera3D" unique_id=931201905]
script = ExtResource("4_j5wjh")
config = SubResource("Resource_vef74")

[node name="YTargetAnimation" type="Node" parent="Camera3D" unique_id=753444433]
script = ExtResource("4_j5wjh")
config = SubResource("Resource_j5wjh")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="." unique_id=2073432316]
transform = Transform3D(0.9114464, 0.32436162, -0.253091, -0.29250705, 0.94348896, 0.15578246, 0.2893184, -0.06795648, 0.95481765, 0, 0, 0)
shadow_enabled = true

[node name="Pages" type="Node3D" parent="." unique_id=1936395579]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.96, -0.54, 0)
script = SubResource("GDScript_hve3p")
page_scenes = Array[PackedScene]([ExtResource("3_fc0e3"), ExtResource("4_7jktm"), ExtResource("8_iotsf")])

[node name="pushpin_manager" type="Node3D" parent="." unique_id=1200090941 node_paths=PackedStringArray("pins", "ui_pins", "player", "edge_obj")]
script = ExtResource("9_hve3p")
pins = [NodePath("pushpin"), null, NodePath("pushpin3")]
pickup_dist = 0.1
ui_pins = [NodePath("../Control/pushpin_ui_control/ui_pushpin"), NodePath("../Control/pushpin_ui_control/ui_pushpin2"), NodePath("../Control/pushpin_ui_control/ui_pushpin3"), NodePath("../Control/pushpin_ui_control/ui_pushpin4"), NodePath("../Control/pushpin_ui_control/ui_pushpin5"), NodePath("../Control/pushpin_ui_control/ui_pushpin6"), NodePath("../Control/pushpin_ui_control/ui_pushpin7"), NodePath("../Control/pushpin_ui_control/ui_pushpin8"), NodePath("../Control/pushpin_ui_control/ui_pushpin9"), NodePath("../Control/pushpin_ui_control/ui_pushpin10")]
player = NodePath("../PlayerSprite")
edge_obj = NodePath("../edge")
edge_obj_dist = 0.3

[node name="pushpin" parent="pushpin_manager" unique_id=65536298 node_paths=PackedStringArray("player") instance=ExtResource("6_ryrav")]
transform = Transform3D(0.02, 0, 0, 0, -8.7422775e-10, -0.02, 0, 0.02, -8.7422775e-10, 1.2349168, -0.51593393, 0.051739097)
player = NodePath("../../PlayerSprite")

[node name="pushpin3" parent="pushpin_manager" unique_id=285274198 node_paths=PackedStringArray("player") instance=ExtResource("6_ryrav")]
transform = Transform3D(0.02, 0, 0, 0, -8.7422775e-10, -0.02, 0, 0.02, -8.7422775e-10, 1.6406991, -0.6446243, 0.051738977)
player = NodePath("../../PlayerSprite")

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="." unique_id=1268595945]
stream = ExtResource("10_hve3p")
autoplay = true

[node name="Control" type="Control" parent="." unique_id=1775790728]
layout_mode = 3
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_right = 40.0
offset_bottom = 40.0
grow_horizontal = 0

[node name="pushpin_ui_control" type="Control" parent="Control" unique_id=1951991676]
anchors_preset = 0
offset_right = 40.0
offset_bottom = 40.0

[node name="ui_pushpin" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=1117308562]
layout_mode = 0
offset_left = -121.0
offset_top = 29.0
offset_right = -21.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin2" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=5822654]
layout_mode = 0
offset_left = -241.0
offset_top = 29.0
offset_right = -141.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin3" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=1705446292]
layout_mode = 0
offset_left = -361.0
offset_top = 29.0
offset_right = -261.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin4" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=543431149]
layout_mode = 0
offset_left = -481.0
offset_top = 29.0
offset_right = -381.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin5" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=916079887]
layout_mode = 0
offset_left = -601.0
offset_top = 29.0
offset_right = -501.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin6" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=566233657]
layout_mode = 0
offset_left = -721.0
offset_top = 29.0
offset_right = -621.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin7" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=1625469636]
layout_mode = 0
offset_left = -841.0
offset_top = 29.0
offset_right = -741.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin8" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=1982600288]
layout_mode = 0
offset_left = -961.0
offset_top = 29.0
offset_right = -861.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin9" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=383953143]
layout_mode = 0
offset_left = -1081.0
offset_top = 29.0
offset_right = -981.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="ui_pushpin10" type="TextureRect" parent="Control/pushpin_ui_control" unique_id=646933080]
layout_mode = 0
offset_left = -1201.0
offset_top = 29.0
offset_right = -1101.0
offset_bottom = 129.0
texture = ExtResource("11_mfdv2")
expand_mode = 1

[node name="PageProjectorOrigin" type="Node3D" parent="." unique_id=1276404290]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.96, -0.54, 5)

[node name="DebugThing" type="Node2D" parent="." unique_id=1209670247]
visible = false
script = SubResource("GDScript_mfdv2")

[node name="edge" parent="." unique_id=2082557506 instance=ExtResource("12_iotsf")]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 1.8053555, -0.5996835, 0.12254257)
